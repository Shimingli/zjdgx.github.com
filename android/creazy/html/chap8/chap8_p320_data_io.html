<!doctype html>
<html><!-- InstanceBegin template="/Templates/zjdgx-notes.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="author" content="zjdgx" />
<!-- InstanceBeginEditable name="doctitle" -->
<meta name="description" content="第8章 Android的数据存储与IO(P320)"/>
<meta name="date" content="20140530" />
<title>zjdgx notes</title>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<style type="text/css">
	html,body{
		background-color: #fff;
	}
	li{
		list-style: none;
	}
	.main{
		font: 12px/1.8 'microsoft yahei',courier new,times new roman;
	}
	.code {
		margin: 0;
		padding: 5px 10px;
		background-color:#e8e8e8;
		font-family: "Courier New", Courier, monospace;
	}
	p.code {
		margin-left: 2em;
	}
	pre.code {
		margin: 0.5em 0;
		line-height: 150%;
		padding: 0.4em 0.6em;
	}
	ol li {
		list-style: decimal;
	}
	.main h1{
		margin: 0;
		font-size: 14px;
	}
	.main h1 a {
		margin-left: 20px;
	}
	.main .point3 {
		padding-left: 5px;
		margin: 5px 0 5px 4em;
	}
	.main .em,
	.main .underline {
		text-decoration: underline;
	}
	.main .italic {
		font-style: italic;
	}
	.main h2 {
		margin: 0;
		margin-top: 10px;
		margin-left: 2em;
		font-size: 12px;
	}
	.main h3 {
		font-size: 12px;
		font-weight: normal;
		margin: 10px 0 0 3em;
	}
	.main ol {
		margin: 0;
		margin-left: 2em;
	}
	.main ol.h3 {
		margin: 0;
		font-size: 12px;
		margin-left: 4em;
	}
	h4 {
		margin: 0;
		text-indent: 5em;
		font-weight: normal;
	}
	table {
		border-collapse: collapse;
		margin-left: 5em;
	}
	table td,table th {
		padding: 2px 20px;
	}
	.table td,.table th {
		border: solid 1px #ccc;
	}
	.exampleCode {
		margin-left: 5em;
	}
	.example {
		width: 65px;
		color: #f00;
		display: block;
		cursor: pointer;
		padding: 2px 5px;
		font-weight: bold;
		text-align: center;
		background-color: #f8f8f8;
	}
	.example i {
		width: 0;
		margin-left: 5px;
		display: inline-block;
		vertical-align: middle;
		border: 5px solid #f86;
		border-width: 5px 5px 0 5px;
		border-color: #f86 transparent transparent transparent;
	}
	.hidden {
		display: none;
	}
	
</style>
<!-- InstanceEndEditable -->
</head>
<body>
	<div class="main">
		<!-- InstanceBeginEditable name="content" -->
		<h1>第8章 Android的数据存储与IO(P320)</h1>
		<h2>本章要点</h2>
		<table cellpadding="0" cellspacing="0">
			<tr>
				<td>SharedPreferences的概念和作用</td>
				<td>使用SharedPreferences保存程序的参数、选项</td>
				<td>读写其他应用的SharedPreferences</td>
			</tr>
			<tr>
				<td>Android的文件IO</td>
				<td>读写SD卡上的文件</td>
				<td>了解SQLite数据库</td>
			</tr>
			<tr>
				<td>使用Android的API操作SQLite数据库</td>
				<td>使用sqlite3工具管理SQLite数据库</td>
				<td>SQLiteOpenHelper类的功能和用法</td>
			</tr>
			<tr>
				<td>Android的手势支持</td>
				<td>手势检测</td>
				<td>向手势库中添加手势</td>
			</tr>
			<tr>
				<td>识别用户手势</td>
				<td>自动朗读支持</td>
			</tr>			
		</table>
		<h2>8.1 使用SharedPreferences(P321)</h2>
		<h3>8.1.1 SharedPreferences与Editor简介(P321)</h3>
		<p class="point3">
			SharedPreferences保存的数据格式是key-value对, 该接口主要负责读取应用程序的Preferences数据, 常用方法如下:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. boolean contains(String key):  判断SharedPreferences是否包含特定key的数据;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. abstract Map&lt;String,?> getAll(): 获取SharedPreferences数据里全部的key-value对;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. boolean getXxx(String key, xxx defValue):  获取SharedPreferences数据里特定的key对应的value, 如果key不存在, 返回默认值defValue.
		</p>
		<p class="point3">
			SharedPreferences接口本身并没有提供写入数据的能力, 而是通过edit()方法获取它所对应的Editor对象, 该对象提供了如下方法来向SharedPreferences写入数据:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. SharedPreferences.Editor clear(): 清空SharedPreferences里的所有数据;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. SharedPreferences.Editor putXxx(String key, Xxx value): 向SharedPreference存入指定key对应的数据(Xxx为基本类型的值);<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. SharedPreferences.Editor remove(String key): 删除SharedPreferences里指定key对应的数据项;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;4. boolean commit(): 当Editor编辑完成后, 调用该方法提交修改.
		</p>
		<p class="point3">
			SharedPreferences本身是一个接口, 只能通过context提供的getSharedPreferences(String name, int mode)来获取SharedPreferences实例. 其中mode值有:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. Context.MODE_PRIVATE: 指定该SharedPreferences数据只能被本程序读写;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. Context.MODE_WORLD_READABLE: 指定该SharedPreferences数据能被其他程序读, 但不能写;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. Context.MODE_WORLD_WRITEABLE: 指定该SharedPreferences数据能被其他程序读写.
		</p>
		<h3>8.1.2 SharedPreferences的存储位置和格式(P322)<h3>
		<h3>8.1.3 读取其他应用的SharedPreferences(P324)</h3>
		<p class="point3">
			读取其他应用程序的SharedPreferences的步骤:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. 创建其他应用程序的Context: useCount = createPackageContext("org.crazyit.io", Context.CONTEXT_IGNORE_SECURITY);<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. 调用其他应用程序context的getSharedPreferences(String name, int mode)获取SharedPreferences对象.
		</p>
		<h2>8.2 File存储(P326)</h2>
		<h3>8.2.1 openFileOutput和openFileInput(P327)</h3>
		<p class="point3">
			Context访问数据文件夹的方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. getDir(String name, int mode): 在应用程序数据文件夹下获取或创建name对应的子目录;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. File getFilesDir(): 获取该应用程序的数据文件夹的绝对路径;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. String[] fileList(): 返回该应用程序数据文件夹下的所有文件;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;4. deleteFile(String name): 删除该应用程序数据文件夹下的指定文件.
		</p>
		<h3>8.2.2 读取SD卡上的文件(P328)</h3>
		<p class="point3">
			读写SD卡文件步骤:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. 调用Environment的getExternalStorageState()方法来判断手机上是否插入了SD卡, 并且应用程序具有读写SD卡的权限;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code">Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)</span><br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. 调用Environment的getExternalStorageDirectory()方法来获取外部存储器---SD卡目录;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. 使用FileInputStream、FileOutputStream、FileReader或FileWriter读写SD卡里的内容.
		</p>
		<h2>8.3 SQLite数据库(P335)</h2>
		<h3>8.3.1 SQLiteDatabase简介</h3>
		<p class="point3">
			打开SQLiteDatabase的静态方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. static SQLiteDatabase openDatabase(String path, SQLiteDatabase.CursorFactory factory, int flags): 打开path文件所代表的SQLite数据库;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. static SQLiteDatabase openOrCreateDatabase(File file, SQLiteDatabase.CursorFactory factory): 打开或创建(如果不存在)file文件所代表的SQLite数据库;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. static SQLiteDatabase openDatabase(String path, SQLiteDatabase.CursorFactory factory): 打开或创建(如果不存在)path文件所代表的SQLite数据库.
		</p>
		<h3>8.3.2 创建数据库和表(P337)</h3>
		<p class="point3">
			SQLiteDatabase db = SQLiteDatabase.openOrCreateDatabase("/mnt/db/temp.db3",null)<br>
			String sql = "create table testtable(a integer primary key,b varchar(200),c varchar(200))"<br>
			db.execSQL(sql).
		</p>
		<h3>8.3.3 使用SQL语句操作SQLite数据库(P337)</h3>
		<p class="point3">
			db.execSQL("insert into testtable values(null,?,?)", new String[]{title,content});
		</p>
		<h3>8.3.4 使用sqlite3工具(P339)</h3>
		<h3>8.3.5 使用特定方法操作SQLite数据库(P341)</h3>
		<h3>8.3.6 事务(P343)</h3>
		<p class="point3">
			SQLiteDatabase提供操作事务的方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. beginTransaction(): 开始事务;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. endTransaction(): 结束事务;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. inTransaction(): 当期上下文是否处于事务中.
		</p>
		<pre class="point3 code">
//开始事务
db.beginTransaction();
try {
   // 执行DML语句
   ...
   // 调用该方法设置事务成功, 否则endTransaction()方法将回滚事务
   dn.setTransactionSuccessful();
} finally {
   // 由事务的标志决定是提交事务还是回滚事务
   db.endTransaction();
}
		</pre>
		<h3>8.3.7 SQLiteOpenHelper类(P344)</h3>
		<p class="point3">
			SQLiteOpenHelper包含的常用方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. synchronized SQLiteDatabase getReadableDatabase(): 以读的方式打开数据库对应的SQLiteDatabase对象;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. synchronized SQLiteDatabase getwritableDatabase(): 以写的方式打开数据库对应的SQLiteDatabase对象;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. abstract void onCreate(SQLiteDatabase db): 第一次创建数据库时回调该方法;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;4. abstract void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion): 当数据库版本更新时回调该方法;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;5. synchronized void close(): 关闭所有打开的SQLiteDatabase.
		</p>
		<h2>8.4 手势(Gesture)(P349)</h2>
		<h3>8.4.1 手势检测(P349)</h3>
		<p class="point3">
			GestureDetector.OnGestureListener包含的事件处理方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. boolean onDown(MotionEvent e): 当触碰事件按下时触发该方法;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY): 当用户在触摸屏上拖过时触发该方法, 其中velocityX、velocityY代表拖过动作在横向、纵向上的速度;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. abstract void onLongPress(MotionEvent e): 当用户在屏幕上长按时触发该方法;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;4. boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX, float distanceY): 当用户在屏幕上滚动时触发该方法;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;5. void onShowPress(MotionEvent e): 当用户在触摸屏上按下、而且还未移动和松开时触发该方法;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;6. boolean onSingleTapUp(MotionEvent e): 用户在触摸屏上的轻击事件将会触发该方法.
		</p>
		<h3>8.4.2 增加手势(P356)</h3>
		<p class="point3">
			Android使用GestureLibrary来代表手势库, 并提供了GestureLibraries工具类来创建手势库, 加载手势库的方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. static GestureLibrary fromFile(String path): 从path代表的文件中加载手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. static GestureLibrary fromFile(File path): 从path代表的文件中加载手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. static GestureLibrary fromPrivateFile(Context context, String name): 从指定应用程序的数据文件夹中name文件中加载手势库;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;4. static GestureLibrary fromRawResource(Context context, int resId): 从resId所代表的资源库中加载手势库.
		</p>
		<p class="point3">
			GestureLibrary对象提供的添加识别手势的方法:<br>
			&nbsp;&nbsp;&nbsp;&nbsp;1. void addGesture(String entryName, Gesture gesture): 添加一个名为entryName的手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;2. Set<String> getGestureEntries(): 获取手势库中所有手势的名称;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;3. ArrayList<Gesture> getGestures(String entryName): 获取entryName名称对应的全部手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;4. ArrayList<Prediction> recognize(Gesture gesture): 从手势库中识别gesture匹配的全部手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;5. void removeEntry(String entryName): 删除手势库中entryName对应的手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;6. void removeGesture(String entryName, Gesture gesture): 删除手势库中entryName、gesture对应的手势;<br>
			&nbsp;&nbsp;&nbsp;&nbsp;7. boolean save(): 当向手势库中添加手势或删除手势后调用该方法保存手势库.
		</p>
		<h3>8.4.3 识别用户的手势(P360)</h3>
		<h2>8.5 自动朗读(TTS)(P361)</h2>
		<p class="point3">
			Android通过TextToSpeech来完成自动朗读.
		</p>
		<h2>8.6 本章小结(P364)</h2>
		<!-- InstanceEndEditable -->
	</div>
	<script type="text/javascript">
		window.onload = function() {
			var examples = document.getElementsByClassName("exampleCode"),
				len = examples.length;
			for(var i=0; i<len; i++) {
				examples[i].onclick = function() {
					showCode(this);
				}
			}
		};
		function showCode( element ) {
			console.log("click");
			var childNodes = element.childNodes,
				len = childNodes.length,
				codeNode, cls = "";
			for(var i=0; i<len; i++) {
				if(childNodes[i].getAttribute != undefined) {
					cls = childNodes[i].getAttribute("class");
				}
				if(cls != null && cls.length > 0 && cls.indexOf("hidden") > -1) {
					codeNode = childNodes[i];
					break;
				}
			}
			if( codeNode.style.display == "" || codeNode.style.display == "none") {
				codeNode.style.display = "block";
			} else {
				codeNode.style.display = "none";
			}
		}
	</script>
</body>
<!-- InstanceEnd -->
</html>